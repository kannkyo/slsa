---
language: ja
---
# SLSA 来歴

このページでは、より大きな [in-toto認証] フレームワークの中で適合する SLSA 来歴の述語について説明します。

Type URI: https://slsa.dev/provenance/lang/ja/v0.2

Version: 0.2

<details>
<summary>Note about 0.x versions</summary>

1.0になるまでは、0.xバージョンを定期的に繰り返していくことになります。0.xの間は、デザインに対するフィードバックを早く得るために、より小さく、より速いリリースに傾いています。
1.0以降は、速報性のある変更の頻度を制限する予定です。

これを管理しやすくするために、以下のことを推奨します。

-   来歴ジェネレーターは、実装時に最新の0.xバージョンを選択し、1.0まではアップグレードする理由がない限り、そのバージョンを維持します。
-   来歴コンシューマーは、すべての既知のバージョンを受け入れ、それらの間で内部的に変換します。

</details>

<details>
<summary>本仕様の他のバージョン</summary>

-   **0.2**
-   [0.1]

</details>

## 目的

アーティファクトまたはアーティファクトのセットがどのように作成されたかを説明します。

この述語は、SLSA の[来歴要件]を満たすために推奨される方法です。

## 前提条件

SLSA [ソフトウェア認証](https://github.com/slsa-framework/slsa/blob/main/controls/attestations.md)とより大きな [in-toto認証] フレームワークの理解。

## モデル

来歴とは、あるエンティティ（`builder`）が、他のアーティファクトを入力（`materials`）として、ある `invocation` を実行することで、1 つ以上のソフトウェアアーティファクト（in-toto認証の [Statement] の `subject`）を生成したという 証明 のことです。
この呼び出しは、順番に `buildConfig` を実行し、実行された内容を記録していきます。
builder を信頼する以外の選択肢はありません。
しかし、builder は、外部のおそらく信頼されていないエンティティの要求に応じて、この操作を行ったかもしれない。
これらの信頼できないパラメータは、invocationの `parameters` 、そして `materials` の一部に含まれています。
最後に、ビルドは[再現性][Reproducible]ために必要な外部からのコントロールを受けない様々な環境パラメータ(`environment`)に依存していたかもしれません。

具体的な例については、[例](#example)を参照してください。

![Model Diagram](../../../images/provenance/v0.2/provenance.svg)

## スキーマ

```jsonc
{
  // Standard attestation fields:
  "_type": "https://in-toto.io/Statement/v0.1",
  "subject": [{ ... }],

  // Predicate:
  "predicateType": "https://slsa.dev/provenance/v0.2",
  "predicate": {
    "builder": {
      "id": "<URI>"
    },
    "buildType": "<URI>",
    "invocation": {
      "configSource": {
        "uri": "<URI>",
        "digest": { /* DigestSet */ },
        "entryPoint": "<STRING>"
      },
      "parameters": { /* object */ },
      "environment": { /* object */ }
    },
    "buildConfig": { /* object */ },
    "metadata": {
      "buildInvocationId": "<STRING>",
      "buildStartedOn": "<TIMESTAMP>",
      "buildFinishedOn": "<TIMESTAMP>",
      "completeness": {
        "parameters": true/false,
        "environment": true/false,
        "materials": true/false
      },
      "reproducible": true/false
    },
    "materials": [
      {
        "uri": "<URI>",
        "digest": { /* DigestSet */ }
      }
    ]
  }
}
```

### パース規約

この述語は、in-toto 認証の [パース規約] に従います。

概要：

-   消費者は認識されないフィールドを無視しなければなりません(MUST)。
-   `predicateTypeURI` は、メジャーバージョン番号が含んでおり、後方互換性のない変更があるたびに、常に変化します。
-   マイナーバージョンの変更は、常に下位互換性があり、「単調」です。このような変更は、`predicateType` を更新しません。
-   プロデューサーは、URI であるフィールド名を使用して拡張フィールドを追加できます(MAY)。

### フィールド

_NOTE: このセクションでは、`predicate`の中のフィールドについて説明します。
`Subject`などの他のトップレベルのフィールドの説明については、[Statement]を参照してください。_

<a id="builder"></a>
`builder` _object, required_

> Identifies the entity that executed the recipe, which is trusted to have
> correctly performed the operation and populated this provenance.
>
> The identity MUST reflect the trust base that consumers care about. How
> detailed to be is a judgement call. For example, [GitHub Actions] supports
> both GitHub-hosted runners and self-hosted runners. The GitHub-hosted runner
> might be a single identity because it's all GitHub from the consumer's
> perspective. Meanwhile, each self-hosted runner might have its own identity
> because not all runners are trusted by all consumers.
>
> Consumers MUST accept only specific (signer, builder) pairs. For example,
> "GitHub" can sign provenance for the "GitHub Actions" builder, and "Google"
> can sign provenance for the "Google Cloud Build" builder, but "GitHub" cannot
> sign for the "Google Cloud Build" builder.
>
> Design rationale: The builder is distinct from the signer because one signer
> may generate attestations for more than one builder, as in the GitHub Actions
> example above. The field is required, even if it is implicit from the signer,
> to aid readability and debugging. It is an object to allow additional fields
> in the future, in case one URI is not sufficient.

<a id="builder.id"></a>
`builder.id` _string ([TypeURI]), required_

> URI indicating the builder's identity.

<a id="buildType"></a>
`buildType` _string ([TypeURI]), required_

> URI indicating what type of build was performed. It determines the meaning of
> `invocation`, `buildConfig` and `materials`.

<a id="invocation"></a>
`invocation` _object, optional_

> Identifies the event that kicked off the build. When combined with
> `materials`, this SHOULD fully describe the build, such that re-running this
> invocation results in bit-for-bit identical output (if the build is
> [reproducible]).
>
> MAY be unset/null if unknown, but this is DISCOURAGED.

<a id="invocation.configSource"></a>
`invocation.configSource` _object, optional_

> Describes where the config file that kicked off the build came from.
> This is effectively a pointer to the source where `buildConfig` came from.

<a id="invocation.configSource.uri"></a>
`invocation.configSource.uri` _string ([TypeURI]), optional_

> URI indicating the identity of the source of the config.

<a id="invocation.configSource.digest"></a>
`invocation.configSource.digest` _object ([DigestSet]), optional_

> Collection of cryptographic digests for the contents of the artifact
> specified by `invocation.configSource.uri`.

<a id="invocation.configSource.entryPoint"></a>
`invocation.configSource.entryPoint` _string, optional_

> String identifying the entry point into the build. This is often a path to a
> configuration file and/or a target label within that file. The syntax and
> meaning are defined by `buildType`. For example, if the `buildType` were
> "make", then this would reference the directory in which to run `make` as well
> as which target to use.
>
> Consumers SHOULD accept only specific `invocation.entryPoint` values. For example,
> a policy might only allow the "release" entry point but not the "debug" entry
> point.
>
> MAY be omitted if the `buildType` specifies a default value.
>
> Design rationale: The `entryPoint` is distinct from `parameters` to make it
> easier to write secure policies without having to parse `parameters`.

<a id="invocation.parameters"></a>
`invocation.parameters` _object, optional_

> Collection of all external inputs that influenced the build on top of
> `invocation.sourceConfig`. For example, if the invocation
> type were "make", then this might be the flags passed to `make` aside from the
> target, which is captured in `invocation.sourceConfig.entryPoint`.
>
> Consumers SHOULD accept only "safe" `invocation.parameters`. The simplest and
> safest way to achieve this is to disallow any `parameters` altogether.
>
> This is an arbitrary JSON object with a schema defined by `buildType`.
>
> This is considered to be incomplete unless `metadata.completeness.parameters`
> is true. Unset or null is equivalent to empty.

<a id="invocation.environment"></a>
`invocation.environment` _object, optional_

> Any other builder-controlled inputs necessary for correctly evaluating the
> build. Usually only needed for [reproducing][reproducible] the build but not
> evaluated as part of policy.
>
> This SHOULD be minimized to only include things that are part of the public
> API, that cannot be recomputed from other values in the provenance, and that
> actually affect the evaluation of the build. For example, this might include
> variables that are referenced in the workflow definition, but it SHOULD NOT
> include a dump of all environment variables or include things like the
> hostname (assuming hostname is not part of the public API).
>
> This is an arbitrary JSON object with a schema defined by `buildType`.
>
> This is considered to be incomplete unless `metadata.completeness.environment`
> is true. Unset or null is equivalent to empty.

<a id="metadata"></a>
`metadata` _object, optional_

> Other properties of the build.

<a id="metadata.buildInvocationId"></a>
`metadata.buildInvocationId` _string, optional_

> Identifies this particular build invocation, which can be useful for finding
> associated logs or other ad-hoc analysis. The exact meaning and format is
> defined by `builder.id`; by default it is treated as opaque and
> case-sensitive. The value SHOULD be globally unique.

<a id="metadata.buildStartedOn"></a>
`metadata.buildStartedOn` _string ([Timestamp]), optional_

> The timestamp of when the build started.

<a id="metadata.buildFinishedOn"></a>
`metadata.buildFinishedOn` _string ([Timestamp]), optional_

> The timestamp of when the build completed.

<a id="metadata.completeness"></a>
`metadata.completeness` _object, optional_

> Indicates that the `builder` claims certain fields in this message to be
> complete.

<a id="metadata.completeness.parameters"></a>
`metadata.completeness.parameters` _boolean, optional_

> If true, the `builder` claims that `invocation.parameters` is complete, meaning
> that all external inputs are propertly captured in `invocation.parameters`.

<a id="metadata.completeness.environment"></a>
`metadata.completeness.environment` _boolean, optional_

> If true, the `builder` claims that `invocation.environment` is complete.

<a id="metadata.completeness.materials"></a>
`metadata.completeness.materials` _boolean, optional_

> If true, the `builder` claims that `materials` is complete, usually through
> some controls to prevent network access. Sometimes called "hermetic".

<a id="metadata.reproducible"></a>
`metadata.reproducible` _boolean, optional_

> If true, the `builder` claims that running `invocation` on `materials` will
> produce bit-for-bit identical output.

<a id="buildConfig"></a>
`buildConfig` _object, optional_

> Lists the steps in the build.
> If `invocation.sourceConfig` is not available, `buildConfig` can be used
> to verify information about the build.
>
> This is an arbitrary JSON object with a schema defined by `buildType`.

<a id="materials"></a>
`materials` _array of objects, optional_

> The collection of artifacts that influenced the build including sources,
> dependencies, build tools, base images, and so on.
>
> This is considered to be incomplete unless `metadata.completeness.materials`
> is true. Unset or null is equivalent to empty.

<a id="materials.uri"></a>
`materials[*].uri` _string ([ResourceURI]), optional_

> The method by which this artifact was referenced during the build.
>
> TODO: Should we differentiate between the "referenced" URI and the "resolved"
> URI, e.g. "latest" vs "3.4.1"?
>
> TODO: Should wrap in a `locator` object to allow for extensibility, in case we
> add other types of URIs or other non-URI locators?

<a id="materials.digest"></a>
`materials[*].digest` _object ([DigestSet]), optional_

> Collection of cryptographic digests for the contents of this artifact.

<a id="example"></a>

## 例

WARNING：これはデモンストレーションのみを目的としています。

例えば、ビルダーが `example-1.2.3.tar.gz` をダウンロードして解凍し、 `make -C src foo CFLAGS=O3` を実行して、ハッシュ `5678...` のファイルを得たとします。
そうすると、証明書は次のようになります。

```jsonc
{
  "_type": "https://in-toto.io/Statement/v0.1",
  // Output file; name is "_" to indicate "not important".
  "subject": [{"name": "_", "digest": {"sha256": "5678..."}}],
  "predicateType": "https://slsa.dev/provenance/v0.2",
  "predicate": {
    "buildType": "https://example.com/Makefile",
    "builder": { "id": "mailto:person@example.com" },
    "invocation": {
      "configSource": {
        "uri": "https://example.com/example-1.2.3.tar.gz",
        "digest": {"sha256": "1234..."},
        "entryPoint": "src:foo",                // target "foo" in directory "src"
      },
      "parameters": {"CFLAGS": "-O3"}           // extra args to `make`
    },
    "materials": [{
      "uri": "https://example.com/example-1.2.3.tar.gz",
      "digest": {"sha256": "1234..."}
    }]
  }
}
```

## More examples

### GitHub Actions

WARNING：これはデモンストレーションのみを目的としています。
GitHub Actions チームは、この設計をまだレビューまたは承認しておらず、まだ実装されていません。詳細は変更される場合があります！

GitHub が来歴を生成するものであり、ランナーが GitHub でホストされている場合、ビルダーは次のようになります。

```json
"builder": {
  "id": "https://github.com/Attestations/GitHubHostedActions@v1"
}
```

セルフホスト型のランナーです。
まだサポートされていません。
どのシステムがランナーをホストしているかを表すURIスキームを考えるか、`builder`に追加のプロパティを追加する必要があります。

GitHub Actions ワークフロー:

```jsonc
"buildType": "https://github.com/Attestations/GitHubActionsWorkflow@v1",
"invocation": {
  "configSource": {
    "entryPoint": "build.yaml:build",
    // The git repo that contains the build.yaml referenced in the entrypoint.
    "uri": "git+https://github.com/foo/bar.git",
    // The resolved git commit hash reflecting the version of the repo used
    // for this build.
    "digest": {"sha1": "abc..."}
  },
  // The only possible user-defined parameters that can affect the build are the
  // "inputs" to a workflow_dispatch event. This is unset/null for all other
  // events.
  "parameters": {
    "inputs": { ... }
  },
  // Other variables that are required to reproduce the build and that cannot be
  // recomputed using existing information. (Documentation would explain how to
  // recompute the rest of the fields.)
  "environment": {
    // The architecture of the runner.
    "arch": "amd64",
    // Environment variables. These are always set because it is not possible
    // to know whether they were referenced or not.
    "env": {
      "GITHUB_RUN_ID": "1234",
      "GITHUB_RUN_NUMBER": "5678",
      "GITHUB_EVENT_NAME": "push"
    },
    // The context values that were referenced in the workflow definition.
    // Secrets are set to the empty string.
    "context": {
      "github": {
        "run_id": "abcd1234"
      },
      "runner": {
        "os": "Linux",
        "temp": "/tmp/tmp.iizj8l0XhS",
      }
    }
  }
}
"materials": [{
  // The git repo that contains the build.yaml referenced above.
  "uri": "git+https://github.com/foo/bar.git",
  // The resolved git commit hash reflecting the version of the repo used
  // for this build.
  "digest": {"sha1": "abc..."}
}]
```

### Google Cloud Build

WARNING: これはデモンストレーションのためのものです。
Google Cloud Buildチームは、このデザインをまだレビューまたは承認しておらず、実装もされていません。
詳細は変更される可能性があります。

実績を生成するのがGoogleで、ワーカーがGoogleでホスティングされている場合、ビルダーは以下のようになります。

```json
"builder": {
  "id": "https://cloudbuild.googleapis.com/GoogleHostedWorker@v1"
}
```

カスタムワーカーです。
まだサポートされていません。
どのシステムがワーカーをホストしているかを表すURIスキームを考えるか、`builder`に追加のプロパティを追加する必要があります。

#### Cloud Build config-as-code

ここでは、`entryPoint`は、CloudBuildの[BuildTrigger](https://cloud.google.com/build/docs/api/reference/rest/v1/projects.triggers)の`filename`を参照しています。

```jsonc
"buildType": "https://cloudbuild.googleapis.com/CloudBuildYaml@v1",
"invocation": {
  // ... in the git repo described by `materials[0]` ...
  "configSource": {
    "entryPoint": "path/to/cloudbuild.yaml",
    // The git repo that contains the cloudbuild.yaml referenced above.
    "uri": "git+https://source.developers.google.com/p/foo/r/bar",
    // The resolved git commit hash reflecting the version of the repo used
    // for this build.
    "digest": {"sha1": "abc..."}
  },
  // The only possible user-defined parameters that can affect a BuildTrigger
  // are the subtitutions in the BuildTrigger.
  "parameters": {
    "substitutions": {...}
  }
}
"buildConfig": {
  // each step in the recipe corresponds to a step in the cloudbuild.yaml
  // the format of this is determined by `buildType`
  "steps": [
    {
      "image": "pkg:docker/make@sha256:244fd47e07d1004f0aed9c",
      "arguments": ["build"]
    }
  ]
}
"materials": [{
  // The git repo that contains the cloudbuild.yaml referenced above.
  "uri": "git+https://source.developers.google.com/p/foo/r/bar",
  // The resolved git commit hash reflecting the version of the repo used
  // for this build.
  "digest": {"sha1": "abc..."}
}]
```

#### クラウドビルドRPC

ここでは、トリガーまたは RPC で定義されたステップをリストします。

```jsonc
"buildType": "https://cloudbuild.googleapis.com/CloudBuildSteps@v1",
"invocation": {
  // Build steps were provided as an argument. No `configSource`
  "parameters": {
    // The substitutions in the build trigger.
    "substitutions": {...}
    // TODO: Any other arguments?
  }
}
"buildConfig": {
  // The steps that were performed. (Format TBD.)
  "steps": [...]
}
```

### コマンドを明示的に実行する

WARNING：これは概念実証にすぎません。まだ標準化されていません。

任意のコマンドの実行：

```jsonc
"buildType": "https://example.com/ManuallyRunCommands@v1",
// There was no entry point, and the commands were run in an ad-hoc fashion.
// There is no `configSource`.
"invocation": null,
"buildConfig": {
    // The list of commands that were executed.
    "commands": [
      "tar xvf foo-1.2.3.tar.gz",
      "cd foo-1.2.3",
      "./configure --enable-some-feature",
      "make foo.zip"
    ],
    // Indicates how to parse the strings in `commands`.
    "shell": "bash"
}
```

## Migrating from 0.1

To migrate from [version 0.1][0.1] (`old`):

```javascript
{
  "builder": old.builder,  // (unchanged)
  "buildType": old.recipe.type,
  "invocation": {
    "configSource": {
      "uri": old.materials[old.recipe.definedInMaterial].uri,
      "digest": old.materials[old.recipe.definedInMaterial].digest,
      "entrypoint": old.recipe.entryPoint
    },
    "parameters": old.recipe.arguments,
    "environment": old.recipe.environment   // (unchanged)
  },
  "buildConfig": null,  // no equivalent in 0.1
  "metadata": {
    "buildInvocationId": old.metadata.buildInvocationId,    // (unchanged)
    "buildStartedOn": old.metadata.buildStartedOn,          // (unchanged)
    "buildFinishedOn": old.metadata.buildFinishedOn,        // (unchanged)
    "completeness": {
      "parameters": old.metadata.completeness.arguments,
      "environment": old.metadata.completeness.environment, // (unchanged)
      "materials": old.metadata.completeness.materials,     // (unchanged)
    },
    "reproducible": old.metadata.reproducible               // (unchanged)
  },
  "materials": old.materials  // optionally removing the configSource
}
```

## 変更履歴

-   0.2: Refactored to aid clarity and added `buildConfig`. The model is
    unchanged.
    -   Replaced `definedInMaterial` and `entryPoint` with `configSource`.
    -   Renamed `recipe` to `invocation`.
    -   Moved `invocation.type` to top-level `buildType`.
    -   Renamed `arguments` to `parameters`.
    -   Added `buildConfig`, which can be used as an alternative to
        `configSource` to validate the configuration.
-   「slsa.dev/provenance」に名前が変更されました
-   0.1.1: `metadata.buildInvocationId` を追加
-   0.1:「in-toto.io/Provenance」という名前の初期バージョン

[0.1]: v0.1.md
[0.2]: v0.2.md
[DigestSet]: https://github.com/in-toto/attestation/blob/main/spec/field_types.md#DigestSet
[GitHub Actions]: #github-actions
[Reproducible]: https://reproducible-builds.org
[ResourceURI]: https://github.com/in-toto/attestation/blob/main/spec/field_types.md#ResourceURI
[SLSA]: https://slsa.dev
[Statement]: https://github.com/in-toto/attestation/blob/main/spec/README.md#statement
[Timestamp]: https://github.com/in-toto/attestation/blob/main/spec/field_types.md#Timestamp
[TypeURI]: https://github.com/in-toto/attestation/blob/main/spec/field_types.md#TypeURI
[in-toto認証]: https://github.com/in-toto/attestation
[パース規約]: https://github.com/in-toto/attestation/blob/main/spec/README.md#parsing-rules
[来歴要件]: ../requirements.md#provenance-requirements
